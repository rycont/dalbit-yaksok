# 소개

달빛약속은 한국어 프로그래밍 언어 인터프리터입니다. 이 문서는 새로운 개발자들이 달빛약속 코드베이스의 내부 구조를 이해하고 기여하는 방법을 돕기 위해 작성되었습니다.

더 자세한 사용자 문서는 아래 링크에서 확인하실 수 있습니다:

- [달빛약속 문법 배우기](/language/1.%20%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0)
- [라이브러리로 사용하기](/library/1.%20%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0)

## 개발 환경 설정

### 필수 도구

- **Deno**: 달빛약속의 런타임입니다. [Deno 공식 설치 가이드](https://deno.land/manual/getting_started/installation)를 참고하여 설치해주세요.

### 프로젝트 설정

1.  **저장소 복제**: 다음 명령어를 사용하여 GitHub에서 저장소를 복제합니다.
    ```bash
    git clone https://github.com/your-username/dalbit-yaksok.git # TODO: Replace with actual repository URL
    cd dalbit-yaksok
    ```
2.  **의존성 캐싱**: 프로젝트를 실행하고 테스트하는 데 필요한 의존성을 미리 캐싱합니다.
    ```bash
    deno cache core/mod.ts test/index.test.ts monaco-language-provider/mod.ts
    ```
3.  **버전 동기화 (선택 사항)**: 프로젝트 내 패키지 버전을 동기화해야 하는 경우 다음 스크립트를 실행합니다. 이는 `deno.json`에 명시된 버전을 프로젝트 전체에 일관되게 적용합니다.
    ```bash
    deno task apply-version
    ```

### 에디터 설정

- **Visual Studio Code (VS Code)** 사용을 권장합니다.
- VS Code를 사용하는 경우, Deno 개발 경험을 향상시키기 위해 [공식 Deno 확장 프로그램 (`denoland.vscode-deno`)](https://marketplace.visualstudio.com/items?itemName=denoland.vscode-deno)을 설치하는 것이 좋습니다. 이 확장은 코드 자동 완성, 타입 체킹, 디버깅 등의 기능을 제공합니다.

## 코드베이스 구조

달빛약속 코드베이스는 명확하고 모듈화된 구조를 지향합니다. 각 디렉토리는 특정 기능을 담당하며, 이는 코드의 이해와 유지보수를 용이하게 합니다.

### 주요 디렉토리

-   `core/`: 달빛약속 인터프리터의 핵심 로직 (렉서, 파서, 실행기 등)이 위치합니다.
    -   `core/mod.ts`: 코어 모듈의 메인 진입점입니다. 인터프리터의 주요 기능을 외부로 노출합니다.
    -   `core/prepare/`: 코드 파싱 및 분석과 관련된 모듈들이 포함됩니다. 여기에는 토크나이저(코드를 작은 단위로 분리)와 파서(토큰을 기반으로 AST 생성)가 포함됩니다.
    -   `core/executer/`: 파싱된 코드(AST)의 실제 실행을 담당하는 모듈입니다.
    -   `core/node/`: AST (Abstract Syntax Tree) 노드의 정의가 포함됩니다. 각 노드는 코드의 특정 구조를 나타냅니다.
    -   `core/value/`: 달빛약속 언어 내에서 사용되는 다양한 값(예: 숫자, 문자열, 리스트 등)의 표현과 관련된 모듈입니다.
-   `docs/`: 사용자 및 개발자 문서가 저장되는 공간입니다. 현재 보고 계신 이 문서도 여기에 포함됩니다.
-   `test/`: 자동화된 테스트 코드 및 다양한 약속(.yak) 예제 파일들이 위치합니다.
    -   `test/codes/`: 인터프리터의 다양한 기능과 문법을 테스트하기 위한 약속 언어 예제 파일들이 저장됩니다.
    -   `test/index.test.ts`: 메인 테스트 러너 또는 주요 테스트 파일입니다. Deno의 내장 테스트 기능을 사용하여 테스트를 실행합니다.
-   `monaco-language-provider/`: 웹 기반 Monaco 에디터에서 달빛약속 언어 하이라이팅, 자동 완성 등의 기능을 제공하기 위한 코드입니다.
    -   `monaco-language-provider/mod.ts`: 모나코 언어 제공자 모듈의 메인 진입점입니다.
-   `quickjs/`: QuickJS 엔진과의 연동을 위한 FFI (Foreign Function Interface) 브릿지 코드입니다. 이를 통해 Deno 환경에서 C로 작성된 QuickJS 엔진을 사용할 수 있습니다.
    -   `quickjs/mod.ts`: QuickJS 모듈의 메인 진입점입니다.
-   `.github/`: GitHub Actions 워크플로우 설정 파일들이 위치합니다. 주로 CI/CD (지속적 통합/지속적 배포) 파이프라인을 정의합니다.
-   `deno.json`: Deno 프로젝트의 설정 파일입니다. 의존성 관리, 사용자 정의 작업 스크립트(예: `deno task test`), 린팅 및 포맷팅 설정 등을 포함합니다.

## 핵심 인터프리터 개념

달빛약속 인터프리터는 소스 코드를 읽어들여 실행 가능한 형태로 변환하고, 이를 실제로 실행하는 과정을 거칩니다. 이 과정은 크게 토큰화, 파싱, 실행의 세 단계로 나눌 수 있습니다.

### 인터프리터 주요 단계

1.  **토큰화 (Tokenization / Lexing)**:
    *   입력된 약속 코드를 더 이상 나눌 수 없는 의미있는 기본 단위인 **토큰(Token)**으로 분해합니다. 예를 들어, `만약 참이면:` 이라는 코드는 `만약`, `참이면`, `:` 등의 토큰으로 나뉩니다.
    *   관련 모듈: `core/prepare/tokenize/`

2.  **파싱 (Parsing)**:
    *   토큰화 단계를 거쳐 생성된 토큰들의 스트림(연속된 흐름)을 입력으로 받습니다.
    *   이 토큰 스트림을 기반으로 코드의 문법적 구조를 분석하고, 이를 나무 형태로 표현하는 **AST(Abstract Syntax Tree, 추상 구문 트리)**를 생성합니다. AST는 코드의 계층적 구조를 나타내어 인터프리터가 코드를 이해하고 실행하는 데 사용됩니다.
    *   관련 모듈: `core/prepare/parse/`

3.  **실행 (Execution)**:
    *   파싱 단계를 통해 생성된 AST를 순회(traverse)하면서 각 노드에 해당하는 연산을 수행합니다.
    *   변수 할당, 함수 호출, 조건문 및 반복문 실행 등 실제 코드의 동작이 이 단계에서 이루어집니다.
    *   관련 모듈: `core/executer/`

### 주요 개념

-   **AST 노드 (AST Nodes)**:
    *   AST를 구성하는 각 요소들을 **노드(Node)**라고 합니다. 각 노드는 약속 코드의 특정 구문(예: 변수 선언, 조건문 `만약`, 반복문 `반복`, 함수 호출 등)이나 표현식(예: `숫자 + 숫자`)을 나타내는 객체입니다.
    *   인터프리터는 이 노드들을 재귀적으로 방문하며 코드를 실행합니다.
    *   다양한 종류의 AST 노드 정의는 `core/node/` 디렉토리에서 찾아볼 수 있습니다. 각 파일은 특정 노드 타입의 구조와 기능을 정의합니다.

-   **값 표현 (Value Representation)**:
    *   인터프리터가 실행 중에 다루는 데이터(예: 숫자 `123`, 문자열 `"안녕하세요"`, 목록 `[1, 2, 3]`, 부울 `참`/`거짓`, 함수 등)를 내부적으로 어떻게 표현하고 관리하는지에 대한 규칙과 구현을 의미합니다.
    *   달빛약속 언어의 각 값 타입에 대응하는 내부 표현 방식이 정의되어 있으며, 이는 `core/value/` 디렉토리의 모듈들에서 확인할 수 있습니다. 예를 들어, 숫자 값을 나타내는 클래스, 문자열 값을 나타내는 클래스 등이 여기에 포함됩니다.

## 테스트 실행하기

달빛약속 프로젝트의 안정성과 정확성을 유지하기 위해 자동화된 테스트가 중요합니다.

### 테스트 실행 명령어

-   프로젝트의 모든 자동화된 테스트를 실행하려면 다음 명령어를 사용합니다:
    ```bash
    deno task --recursive test
    ```
    이 명령어는 프로젝트 전체(하위 워크스페이스 패키지 포함)에 걸쳐 정의된 모든 테스트를 실행합니다.
-   각 워크스페이스 패키지의 `deno.json` 파일 내 `tasks` 섹션에서 개별 테스트 스크립트 정의를 찾아볼 수 있습니다.

### 테스트 구조

-   **`test/` 디렉토리**:
    *   프로젝트의 주요 테스트 관련 파일들이 이 디렉토리에 위치합니다.
-   **`test/codes/` 하위 디렉토리**:
    *   이 디렉토리에는 수많은 `.yak` 파일(약속 언어로 작성된 코드 예제)이 포함되어 있습니다. 이 파일들은 인터프리터의 다양한 기능과 문법 사항을 테스트하는 데 사용됩니다.
    *   대부분의 `.yak` 파일에 대해, 예상되는 실행 결과를 담고 있는 `.yak.out` 파일이 쌍으로 존재합니다.
    *   테스트 실행 시, 해당 `.yak` 파일을 실행한 실제 결과와 `.yak.out` 파일의 내용을 비교하여 일치하는지 확인합니다.
-   **`test/index.test.ts`**:
    *   이 파일은 `test/codes/` 내의 `.yak` 파일들을 읽어 실행하고, 그 결과를 예상 출력과 비교하는 테스트 로직의 주요 진입점일 가능성이 높습니다. Deno의 내장 테스트 모듈을 사용하여 테스트 케이스들을 정의하고 실행합니다.

## 기여하기

달빛약속 프로젝트에 기여해주셔서 감사합니다! 다음은 기여를 위한 몇 가지 가이드라인입니다.

### 코드 스타일 (Coding Style)

-   이 프로젝트는 코드 포맷팅을 위해 Prettier를, 린팅을 위해 Deno Lint를 사용합니다.
-   코드를 커밋하기 전에 다음 명령어를 실행하여 코드 스타일을 일관되게 유지해주세요:
    -   포맷팅: `deno fmt`
    -   린팅: `deno lint`
-   Prettier 설정은 `.prettierrc` 파일에, Deno Lint 규칙은 `deno.json` 파일에 정의되어 있습니다.

### 개발 워크플로우 (Development Workflow)

이 프로젝트는 표준 GitHub flow를 따릅니다:

1.  달빛약속 프로젝트를 GitHub에서 Fork합니다.
2.  새로운 기능 개발이나 버그 수정을 위해 로컬 저장소에서 새로운 브랜치를 생성합니다. (예: `git checkout -b feature/새로운-기능-이름` 또는 `git checkout -b bugfix/이슈-번호`)
3.  코드를 수정하고, 변경 사항에 대한 테스트 코드를 추가하거나 기존 테스트를 수정합니다.
4.  작업 내용을 설명하는 명확한 커밋 메시지를 작성합니다.
5.  변경 사항을 Fork한 개인 저장소로 Push합니다.
6.  원본 달빛약속 저장소로 Pull Request (PR)를 생성합니다. PR에는 변경 내용과 이유를 상세히 기술해주세요.

### 버그 리포트 및 기능 제안 (Bug Reports and Feature Requests)

-   버그를 발견했거나 새로운 기능을 제안하고 싶다면, GitHub Issues를 사용해주세요.
-   새로운 이슈를 생성하기 전에 기존 이슈 목록을 검색하여 중복되는 내용이 있는지 확인하는 것이 좋습니다.

### 커밋 메시지 가이드라인 (Commit Message Guidelines)

-   커밋 메시지는 간결하고 명확하게 작성하는 것을 권장합니다.
-   메시지 형식은 Conventional Commits 스타일을 따르는 것을 제안합니다:
    -   `feat: 새로운 기능 추가 (간단한 설명)`
    -   `fix: 버그 수정 (간단한 설명)`
    -   `docs: 문서 변경 사항`
    -   `style: 코드 스타일 변경 (포맷팅, 세미콜론 등)`
    -   `refactor: 코드 리팩토링 (기능 변경 없음)`
    -   `test: 테스트 추가 또는 수정`
    -   `chore: 빌드 관련 작업, 패키지 매니저 설정 변경 등`
-   또는, 명령형으로 현재 시제를 사용하여 작성할 수 있습니다. (예: `버그를 수정함` 또는 `새로운 기능 추가`)

### 새로운 테스트 작성 (Writing New Tests)

-   새로운 기능을 추가하거나 버그를 수정할 때는 관련 테스트 코드를 작성하는 것이 매우 중요합니다.
-   테스트 코드는 주로 `test/codes/` 디렉토리에 `.yak` 파일 형태로 추가됩니다.
-   새로운 테스트 케이스를 추가하거나 기존 테스트를 수정하여 코드 변경 사항이 예상대로 작동하는지, 그리고 기존 기능에 영향을 미치지 않는지 확인해주세요.
-   필요한 경우, `.yak.out` 파일을 만들어 예상 결과를 명시합니다.
