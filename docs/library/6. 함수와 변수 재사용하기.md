# 6. 함수와 변수 재사용하기(Base Context)

Base Context는 약속 코드 실행 결과를 저장하고 재사용할 수 있는 기능입니다. 이를 활용하면 함수와 변수를 여러번 재사용할 수 있습니다. 구체적으로 다음과 같이 활용할 수 있습니다:

1. 내장 함수: 기능 구현에 필요한 함수(약속과 번역)를 미리 구현해둬서 런타임에 삽입하기
2. REPL(Run-Eval-Print Loop): Python IDLE와 같은 대화형 콘솔 구현하기

Base Context 기능의 사용 방법은 다음과 같이 두 단계로 구성됩니다.

## 1. 소스코드의 실행 결과(CodeFile)를 저장해두기

```ts
import { CodeFile, yaksok } from '@dalbit-yaksok/core'

const baseCode: CodeFile = `
약속, 힘든 부탁 하기
    "그건 제가 도와드릴 수 없어요" 보여주기
`

const baseContext = (await yaksok(baseCode)).codeFiles['main']
```

재사용할 함수와 변수가 담긴 소스코드를 실행하여 변수로 저장합니다. 소스코드의 실행 결과중 [`CodeFile` 인스턴스](/api/core/mod/classes/CodeFile.html)가 필요합니다. CodeFile 인스턴스는 `yaksok` 함수의 실행 결과 중 `codeFiles`라는 객체 파일 이름별로 저장되어 있으며, 파일 이름을 별도로 지정하지 않는 경우엔 `main`이라는 이름으로 저장됩니다.

## 2. 이후에 실행하는 yaksok 함수에 전달하기

```ts
await yaksok(`힘든 부탁 하기`, {}, baseContext) // 출력: "그건 제가 도와드릴 수 없어요"
```

codeFile 객체를 `yaksok` 함수의 세 번째 인자로 넘기면 이전 소스코드에서 선언한 함수와 변수를 재사용할 수 있습니다.

## 전체 소스코드

```ts
import { CodeFile, yaksok } from '@dalbit-yaksok/core'

const baseCode: CodeFile = `
약속, 힘든 부탁 하기
    "그건 제가 도와드릴 수 없어요" 보여주기
`

const baseContext = (await yaksok(baseCode)).codeFiles['main']
await yaksok(`힘든 부탁 하기`, {}, baseContext) // 출력: "그건 제가 도와드릴 수 없어요"
```

## 주의 사항: 스코프는 재사용됩니다

```ts
import { CodeFile, yaksok } from '@dalbit-yaksok/core'

const baseContext: CodeFile = (
    await yaksok(`
카운터 = 1

약속, 힘든 부탁 하기
    "그건 제가 도와드릴 수 없어요" 보여주기
    카운터 = 카운터 + 1
`)
).codeFiles['main']

await yaksok(`힘든 부탁 하기`, {}, baseContext)
await yaksok(`힘든 부탁 하기`, {}, baseContext)
await yaksok(
    `
"당신이 힘든 부탁을 한 횟수: " + 카운터 보여주기`,
    {},
    baseContext,
) // 출력: "당신이 힘든 부탁을 한 횟수: 3"
```

`yaksok` 함수를 여러번 사용할 때 동일한 baseContext를 재사용한다면 각 실행에서 변경된 값이 그대로 유지됩니다. 그렇기에 위 경우 baseContext의 `카운터` 변수가 여러번 재사용되어, `3`가 출력됩니다.
